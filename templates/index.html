{%- extends "base.html" %}

{% import "bootstrap/utils.html" as utils %}

{% block content %}
    <div class="container">
    {%- with messages = get_flashed_messages(with_categories=True) %}
    {%- if messages %}
        <div class="row">
            <div class="col-md-12">
                {{ utils.flashed_messages(messages) }}
            </div>
        </div>
    {%- endif %}
    {%- endwith %}
        <div class="jumbotron">
            <p>Hello! :-)</p>
            <form action="" method=post>
                <p>Youtube URL:<br />
                    <input type=text name=yturl size=100 />
                    <input type=submit value=Get! class="btn btn-lg btn-default"/>
                </p>
            </form>
        </div>

        <h3>Queued Downloads</h3>
        <table class="table table-striped">
            <thead><tr>
                <th>Submitted</th>
                <th>Job ID</th>
                <th>Requested URL</th>
                <th>Job Status</th>
            </tr></thead>
            <tbody>
            {% for job in jobs %}
                <tr>
                    <td>{{ job.submitted }}</td>
                    <td><a href="{{ job.results_url }}">{{ job.job_id }}</a></td>
                    <td><a href="{{ job.request_url }}">{{ job.request_url }}</a></td>
                    <td>{{ job.status }}</td>
                </tr>
            {% else %}
                <tr>
                    <td><i>Nothing queued for downloading right now. Add a new task using the search box, above.</i></td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

        <h3>Completed Downloads</h3>
        <table class="table table-striped">
            <thead><tr>
                <th>Name</th>
                <th>Downloaded At</th>
                <th>File Size (Bytes)</th>
            </tr></thead>
            <tbody>
            {% for name,modified,size,link in available %}
                <tr>
                    <td><a href="{{ link }}">{{ name|truncate(60) }}</a></td>
                    <td>{{ modified }}</td>
                    <td>{{ size|filesizeformat }} ({{ size }})</td>
                </tr>
            {% else %}
                <tr>
                    <td><i>Looks like there isn't anything here yet. Try downloading something using the search box, above.</i></td>
                    <td>-</td>
                    <td>-</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{%- endblock %}
